<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GündemLive - Hızlı Haber Portalı</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2965/2965879.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #1a3e72;
      --accent-color: #ff5722;
      --card-bg: #fff;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
    }
    .navbar {
      background-color: var(--primary-color);
    }
    .news-card {
      transition: transform 0.2s;
    }
    .news-card:hover {
      transform: translateY(-5px);
    }
    /* Diğer stil tanımlamaları... */
  </style>
</head>
<body>

<!-- Navbar ve diğer HTML elemanları... -->

<script>
  // Önbellek mekanizması
  const NEWS_CACHE_KEY = 'gundemlive_news_cache';
  const CACHE_EXPIRE_TIME = 5 * 60 * 1000; // 5 dakika

  async function fetchNews() {
    // Önce önbelleği kontrol et
    const cachedNews = checkCache();
    if (cachedNews) {
      displayNews(cachedNews);
      return;
    }

    showLoader();
    
    try {
      const sources = [
        'https://www.trthaber.com/manset_articles.rss',
        'https://www.ntv.com.tr/gundem.rss'
      ];
      
      // Paralel olarak birden fazla kaynaktan veri çek
      const promises = sources.map(src => 
        fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(src)}`)
          .then(res => res.json())
          .catch(() => null)
      );
      
      const results = await Promise.all(promises);
      const validResults = results.filter(r => r?.status === 'ok');
      
      if (validResults.length === 0) throw new Error('No valid sources');
      
      // Haberleri birleştir ve sırala
      let allNews = [];
      validResults.forEach(result => {
        allNews = [...allNews, ...result.items];
      });
      
      // Tarihe göre sırala ve eski haberleri filtrele
      allNews.sort((a,b) => new Date(b.pubDate) - new Date(a.pubDate));
      const recentNews = allNews.filter(item => 
        new Date(item.pubDate) > new Date(Date.now() - 24*60*60*1000)
      );
      
      // Önbelleğe kaydet
      saveToCache(recentNews);
      displayNews(recentNews);
      
    } catch (error) {
      console.error("Haber yükleme hatası:", error);
      showError();
    } finally {
      hideLoader();
    }
  }

  function checkCache() {
    const cachedData = localStorage.getItem(NEWS_CACHE_KEY);
    if (!cachedData) return null;
    
    const { data, timestamp } = JSON.parse(cachedData);
    if (Date.now() - timestamp > CACHE_EXPIRE_TIME) return null;
    
    return data;
  }

  function saveToCache(data) {
    const cacheData = {
      data,
      timestamp: Date.now()
    };
    localStorage.setItem(NEWS_CACHE_KEY, JSON.stringify(cacheData));
  }

  function displayNews(newsItems) {
    const container = document.getElementById('newsContainer');
    container.innerHTML = '';
    
    // İlk 12 haber için basit kart oluştur
    newsItems.slice(0,12).forEach(item => {
      const imgUrl = extractImageUrl(item.description);
      const card = `
        <div class="col-md-4 mb-4">
          <div class="card news-card h-100">
            <img src="${imgUrl}" class="card-img-top" loading="lazy" 
                 onerror="this.src='https://via.placeholder.com/300x200?text=Resim+Yok'">
            <div class="card-body">
              <h5 class="card-title">${item.title}</h5>
              <p class="card-text">${truncateText(item.description, 100)}</p>
              <a href="${item.link}" class="btn btn-primary">Haberi Oku</a>
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    });
  }

  function extractImageUrl(html) {
    const match = html.match(/<img[^>]+src="([^"]+)"/);
    return match ? match[1] : 'https://via.placeholder.com/300x200?text=Resim+Yok';
  }

  function truncateText(text, maxLength) {
    const cleanText = text.replace(/<[^>]*>?/gm, '');
    return cleanText.length > maxLength 
      ? cleanText.substring(0, maxLength) + '...' 
      : cleanText;
  }

  // Sayfa yüklendiğinde haberleri getir
  document.addEventListener('DOMContentLoaded', () => {
    fetchNews();
    // Her 5 dakikada bir güncelle
    setInterval(fetchNews, 5 * 60 * 1000);
  });
</script>
</body>
</html>
